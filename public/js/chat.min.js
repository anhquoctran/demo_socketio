$(document).ready(function(){function n(){var n=i.val().trim();""==$.trim(n)?alert("Input can not be left blank"):"/"==n[0]?(t(n),i.val("")):(r.emit("message",{user:p,name:m,message:n,time:new Date}),i.val(""))}function a(){return Math.floor(Math.random()*(9e6+1))+999999}function e(n,a){var e="<b>"+n+"</b>: ",t=e+a;s(t)}function s(n){l.append(n).append("<br>").animate({scrollTop:l.prop("scrollHeight")},500)}function t(n){if("?"===n[1]||""===n[1]||" "===n[1]){var a="<span class='info'>--------------------------------------------------------------------<br>";a+="Help:<br>",a+="--------------------------------------------------------------------<br>",a+="- type /? for help<br>",a+="- type <b>/name</b> [<b>newname</b>] to change your display name<br>",a+="- type <b>/id</b> to display your current ID<br>",a+="- type <b>/online</b> to show all online users",a+="- </span>",l.append(a).append("<br>").animate({scrollTop:l.prop("scrollHeight")},500)}else if("/id"===n){var e="<span class='info'>Your ID: <span class='success'>"+p+"</span></span>";l.append(e).append("<br>").animate({scrollTop:l.prop("scrollHeight")},500)}else if(n.startsWith("/name ")){var s=n.split(" "),t=s[1];t&&""!=t&&" "!=t&&o(t)}else n.startsWith("/online")&&r.emit("stats")}function o(n){m=n?n:prompt("What's your name?",u).trim(),null==m&&""==m&&m==u||($("#yourName").html(m),r.emit("changename",{user:p,name:m}))}var r=io(),i=$("#usermsg"),c=$("#submitmsg"),l=$("#chatbox"),p=a(),u="user_"+p.toString(),m=u;$("#yourId").html(p.toString()),$("#yourName").html(u),$("#exit").click(function(){confirm("Are you sure want to exit this conversation?")&&(r.emit("end"),window.location="/")}),$("#yourName").click(function(n){n.preventDefault(),o(null)}),c.click(function(a){n()}),i.keydown(function(a){13==a.keyCode&&n()}),r.emit("join",{user:p,name:m}),r.on("receiv",function(n){e(n.name,n.message)}),r.on("left",function(n){var a="<b>"+n.name+"</b> ",e="<span class='info'>"+a+"has <span class='error'>left</span></span>";s(e)}),r.on("new",function(n){var a="<b>"+n.name+"</b> ",e="<span class='info'>"+a+" has <span class='success'>joined</span></span>";s(e)}),r.on("usernewname",function(n){var a="An user with ID <b>"+n.user+"</b> has changed name to ",e="<span class='info'>"+a+"<b>"+n.name+"</b></span>";s(e)}),r.on("stats_count",function(n){var a="<span class='info'>";a+="Online: "+n.total+"<br>",n.clients.forEach(function(n){a+="<span class='success'>"+n.name+"<span><br>"}),a+="</span>",s(a)})});